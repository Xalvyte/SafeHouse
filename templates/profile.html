<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Profile Settings</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/profile.css') }}">
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&display=swap" rel="stylesheet">
</head>
<body class="bg-gray-900 text-gray-200 flex min-h-screen">
  <!-- Sidebar -->
  <aside id="sidebar"
    class="sidebar fixed inset-y-0 left-0 w-64 md:w-64 w-4/5 max-w-xs bg-gray-800 shadow-lg p-6 flex flex-col transition-transform duration-300 z-40"
    style="transform: translateX(0);">
    <h2 class="text-3xl font-bold text-white logo-font mb-2 text-center animate-pulse">
        Safehouse
    </h2>
    <hr class="border-gray-700 mb-4">
    <nav class="space-y-2">
        <a href="{{ url_for('dashboard') }}"
            class="sidebar-link {% if request.endpoint == 'dashboard' %}active{% endif %}">
            <i data-lucide="home"></i> Home
        </a>
        <a href="{{ url_for('add_user') }}"
            class="sidebar-link {% if request.endpoint == 'add_user' %}active{% endif %}">
            <i data-lucide="user-plus"></i> Add User
        </a>
        <a href="{{ url_for('manage_users') }}" class="sidebar-link {% if request.endpoint == 'manage_users' %}active{% endif %}">
            <i data-lucide="users"></i> Manage Users
        </a>
        <a href="{{ url_for('profile') }}"
            class="sidebar-link {% if request.endpoint == 'profile' %}active{% endif %}">
            <i data-lucide="settings"></i> Profile Settings
        </a>
        <a href="{{ url_for('logout') }}"
            class="sidebar-link logout-link {% if request.endpoint == 'logout' %}active-logout{% endif %}">
            <i data-lucide="log-out"></i> Logout
        </a>
    </nav>
    <!-- Toggle button: middle right of sidebar, two arrows -->
    <button id="menu-btn"
        class="absolute right-0 top-1/2 -translate-y-1/2 translate-x-1/2 z-50 px-2 py-2 bg-gray-700 rounded-full text-gray-200 hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-indigo-500 transition flex items-center gap-1"
        style="box-shadow: 0 2px 8px rgba(0,0,0,0.15);">
        <i data-lucide="chevron-left"></i>
        <i data-lucide="chevron-right"></i>
    </button>
  </aside>
  <!-- Overlay for mobile when sidebar is open -->
  <div id="sidebar-overlay" class="fixed inset-0 bg-black bg-opacity-40 z-30 hidden md:hidden"></div>

  <!-- Main Content -->
  <div class="flex-1 p-8 ml-64 flex flex-col items-center" id="main-content">
    <div class="w-full max-w-xl">
      <h1 class="text-4xl font-bold mb-8 text-center">Profile Settings</h1>
      
      {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
          <div class="mb-6">
            {% for category, message in messages %}
              <div class="px-4 py-3 rounded-lg mb-2
                {% if category == 'success' %}bg-green-700 text-green-100
                {% elif category == 'error' %}bg-red-700 text-red-100
                {% else %}bg-gray-700 text-gray-100{% endif %}">
                {{ message }}
              </div>
            {% endfor %}
          </div>
        {% endif %}
      {% endwith %}

      <form action="{{ url_for('profile') }}" method="POST" class="profile-form">
        <div>
          <label class="block mb-2 font-semibold text-gray-300">Username</label>
          <input type="text" name="username" value="{{ user.username }}" class="profile-input" required>
        </div>
        <div>
          <label class="block mb-2 font-semibold text-gray-300">Current Email</label>
          <div class="mb-2 px-4 py-2 rounded-lg bg-gray-700 text-indigo-300 border border-indigo-500 font-mono select-all">
            {{ user.email }}
          </div>
          <label class="block mb-2 font-semibold text-gray-300 mt-4">New Email</label>
          <input type="email" name="email" value="{{ user.email }}" class="profile-input" required>
          <p class="text-xs text-gray-500 mt-1">Enter a new email to update, or leave unchanged to keep your current email.</p>
        </div>
        <div>
          <label class="block mb-2 font-semibold text-gray-300">New Password</label>
          <input type="password" name="password" placeholder="••••••••" class="profile-input">
          <p class="text-xs text-gray-500 mt-1">Leave blank to keep your current password.</p>
        </div>
        <button type="submit" class="profile-btn mt-4">Save Changes</button>
      </form>
    </div>
  </div>
  <script>
    const menuBtn = document.getElementById("menu-btn");
    const sidebar = document.getElementById("sidebar");
    const mainContent = document.getElementById("main-content");
    const sidebarOverlay = document.getElementById("sidebar-overlay");
    let sidebarVisible = true;

    function showSidebar() {
        sidebar.style.transform = "translateX(0)";
        if (window.innerWidth < 768) {
            sidebarOverlay.classList.remove("hidden");
            if (mainContent) mainContent.classList.remove("md:ml-64");
        } else {
            sidebarOverlay.classList.add("hidden");
            if (mainContent) mainContent.classList.add("md:ml-64");
        }
    }

    function hideSidebar() {
        sidebar.style.transform = "translateX(-100%)";
        sidebarOverlay.classList.add("hidden");
        if (mainContent) mainContent.classList.remove("md:ml-64");
    }

    menuBtn.addEventListener("click", () => {
        sidebarVisible = !sidebarVisible;
        if (sidebarVisible) {
            showSidebar();
        } else {
            hideSidebar();
        }
    });

    // Hide sidebar when overlay is clicked (mobile)
    sidebarOverlay.addEventListener("click", () => {
        sidebarVisible = false;
        hideSidebar();
    });

    // Responsive: show/hide sidebar on resize
    window.addEventListener("resize", () => {
        if (window.innerWidth >= 768) {
            sidebarVisible = true;
            showSidebar();
        } else if (!sidebarVisible) {
            hideSidebar();
        }
    });

    lucide.createIcons();
    function confirmLogout(event) {
      event.preventDefault();
      if (confirm("Are you sure you want to log out?")) {
        window.location.href = "{{ url_for('logout') }}";
      }
    }
  </script>
</body>
</html>
